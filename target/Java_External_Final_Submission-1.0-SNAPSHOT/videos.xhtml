<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Videos Management</title>
        <h:outputStylesheet name="css/videos.css"/>
    </h:head>
    <h:body>
        <h:form id="videosForm">
            <!-- Header with Search -->
            <div class="page-header">
                <h2>Videos Management</h2>
                <p:inputText id="searchInput" value="#{videoLisingBean.searchTerm}" 
                             placeholder="Search by title or uploader..."
                             styleClass="search-bar">
                    <p:ajax event="keyup" listener="#{videoLisingBean.searchVideos()}"
                            update="videosTable"/>
                </p:inputText>
            </div>

            <!-- Videos Table -->
            <p:dataTable id="videosTable" value="#{videoLisingBean.filteredVideos}" var="video"
                         styleClass="video-table" emptyMessage="No videos found." lazy="false">
                <p:column headerText="Title">
                    <h:outputText value="#{video.title}"/>
                </p:column>
                <p:column headerText="Uploader">
                    <h:outputText value="#{video.userID.fullName}"/>
                </p:column>
                <p:column headerText="Category">
                    <h:outputText value="#{video.categoryID != null ? video.categoryID.categoryName : 'Uncategorized'}"/>
                </p:column>
                <p:column headerText="Upload Date">
                    <h:outputText value="#{videoLisingBean.formatDate(video.uploaddate)}"/>
                </p:column>
                <p:column headerText="Status">
                    <h:outputText value="#{video.status}"/>
                </p:column>
                <p:column headerText="Actions" styleClass="action-column">
                    <p:commandButton value="View Details" styleClass="view-btn"
                                     action="#{videoLisingBean.viewVideoDetails(video)}"
                                     update=":videosForm:videoDetailsDialog"/>
                </p:column>
            </p:dataTable>

            <!-- Video Details Dialog -->
            <p:dialog id="videoDetailsDialog" header="Video Details" widgetVar="videoDetailsDialog"
                      modal="true" styleClass="video-details-dialog" resizable="false">
                <h:panelGroup rendered="#{videoLisingBean.selectedVideo != null}">
                    <h:panelGrid columns="2" styleClass="video-info-grid">
                        <h:outputLabel value="Title:"/>
                        <h:outputText value="#{videoLisingBean.selectedVideo.title}"/>
                        <h:outputLabel value="Uploader:"/>
                        <h:outputText value="#{videoLisingBean.selectedVideo.userID.fullName}"/>
                        <h:outputLabel value="Category:"/>
                        <h:outputText value="#{videoLisingBean.selectedVideo.categoryID != null ? videoLisingBean.selectedVideo.categoryID.categoryName : 'Uncategorized'}"/>
                        <h:outputLabel value="Upload Date:"/>
                        <h:outputText value="#{videoLisingBean.formatDate(videoLisingBean.selectedVideo.uploaddate)}"/>
                        <h:outputLabel value="Duration:"/>
                        <h:outputText value="#{videoLisingBean.formatDuration(videoLisingBean.selectedVideo.duration)}"/>
                        <h:outputLabel value="Views:"/>
                        <h:outputText value="#{videoLisingBean.formatViewCount(videoLisingBean.selectedVideo.viewscount)}"/>
                        <h:outputLabel value="Likes:"/>
                        <h:outputText value="#{videoLisingBean.getVideoStatistics(videoLisingBean.selectedVideo).get('likes')}"/>
                        <h:outputLabel value="Comments:"/>
                        <h:outputText value="#{videoLisingBean.getVideoStatistics(videoLisingBean.selectedVideo).get('comments')}"/>
                        <h:outputLabel value="Status:"/>
                        <h:outputText value="#{videoLisingBean.selectedVideo.status}"/>
                    </h:panelGrid>

                    <h3>Watch Video</h3>
                    <h:panelGrid columns="1">
<!--                        <h:panelGroup rendered="#{videoLisingBean.videoUrl != null}">
                            <a href="#{request.contextPath}#{videoLisingBean.videoUrl}" target="_blank">Click here to watch video</a>
                        </h:panelGroup>-->
                        <h:panelGroup rendered="#{videoLisingBean.videoUrl != null}">
                            <video controls="controls" width="640" height="360">
                                <source src="#{request.contextPath}#{videoLisingBean.videoUrl}" type="video/mp4" />
                                Your browser does not support the video tag.
                            </video>                   
                        </h:panelGroup>
                        <h:panelGroup rendered="#{videoLisingBean.videoUrl == null}">
                            <p>Video file not available.</p>
                        </h:panelGroup>
                    </h:panelGrid>
                    <p:commandButton value="Close" onclick="PF('videoDetailsDialog').hide();" styleClass="close-btn"/>
                </h:panelGroup>
            </p:dialog>
        </h:form>
    </h:body>
</html>